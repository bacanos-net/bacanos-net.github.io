<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bacanos Store — Filtro e Detalhes</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="jolly_roger_sapofrog.png" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=JetBrains Mono' rel='stylesheet'>
</head>
<body>
    <header>
        <div class="logo">
            <h1>BacanosStore</h1><img src="jolly_roger_sapofrog.png">
        </div>

        <div class="search-bar">
            <input type="text" id="header-busca" placeholder="Buscar jogos...">
            <div id="suggestions" class="suggestions"></div>
            <button id="header-buscar">Buscar</button>
        </div>
    </header>
    <nav>
            <ul>
                <li><a href="bacanosstore.html">Início</a></li>
                <li><a href="allgames.html">Jogos</a></li>
                <li><a href="promocao.html">Promoções</a></li>
                <li><a href="novidade.html">Novidades</a></li>
                <li><a href="contato.html">Contato</a></li>
            </ul>
        </nav>
  <h1>Bacanos Store</h1>

  <label for="filter">Filtrar por gênero:</label>
  <select id="filter">
    <option value="todos">Todos</option>
  </select>

  <input type="text" id="busca" placeholder="Buscar jogo..." />
  <button id="anterior">←</button>
  <span id="pagina-atual">1</span>
  <button id="proximo">→</button>
  <div id="lista-jogos"></div>

  <div id="detalhes" style="display:none;">
    <button id="voltar">← Voltar</button>
    <img id="detalhe-img" alt="" />
    <h2 id="detalhe-titulo"></h2>
    <p id="detalhe-descricao"></p>
    <p><strong>Gêneros:</strong> <span id="detalhe-generos"></span></p>
    <p><strong>Data de lançamento:</strong> <span id="detalhe-release"></span></p>
    <p><strong>Preço:</strong> <span id="detalhe-preco"></span></p>
  </div>

<script>
const listaJogos = document.getElementById('lista-jogos');
const filterSelect = document.getElementById('filter');
const buscaInput = document.getElementById('busca');

let paginaAtual = 1;
let jogos = [];
let generosSet = new Set();

function criarCard(jogo) {
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <img src="https://cdn.cloudflare.steamstatic.com/steam/apps/${jogo.appid}/header.jpg" alt="${jogo.name}" />
    <div class="info">
      <div class="title">${jogo.name}</div>
    </div>
  `;
  card.onclick = () => mostrarDetalhes(jogo);
  return card;
}

function mostrarDetalhes(jogo) {

  detalhes.style.display = 'block';
}

function popularFiltro() {
  filterSelect.innerHTML = '<option value="todos">Todos</option>';
  Array.from(generosSet).sort().forEach(g => {
    const opt = document.createElement('option');
    opt.value = g;
    opt.textContent = g;
    filterSelect.appendChild(opt);
  });
}

function filtrarJogos() {
  const filtro = filterSelect.value;
  const busca = buscaInput.value.trim().toLowerCase(); // ADICIONADO
  listaJogos.innerHTML = '';
  let filtrados = filtro === 'todos' ? jogos : jogos.filter(j => (j.genres || []).includes(filtro));
  if (busca) {
    filtrados = filtrados.filter(jogo => jogo.name.toLowerCase().includes(busca));
  }
  filtrados.forEach(jogo => {
    listaJogos.appendChild(criarCard(jogo));
  });
}

async function carregarJogos() {
  listaJogos.textContent = 'Carregando...';
  try {
    // Busca os jogos da página atual
    const res = await fetch(`http://localhost:3000/api/jogo?page=${paginaAtual}&limit=20`);
    if (!res.ok) throw new Error('Falha ao carregar jogos');
    jogos = await res.json();

    generosSet.clear();
    jogos.forEach(j => {
      if (j.genres) j.genres.forEach(g => generosSet.add(g));
    });

    popularFiltro();
    filtrarJogos();
    document.getElementById('pagina-atual').textContent = paginaAtual;
  } catch (e) {
    listaJogos.textContent = 'Erro ao carregar jogos.';
    console.error(e);
  }
}

filterSelect.addEventListener('change', () => {
  buscaInput.value = '';
  filtrarJogos();
});

buscaInput.addEventListener('input', filtrarJogos);

document.getElementById('proximo').onclick = () => {
  paginaAtual++;
  buscaInput.value = '';
  carregarJogos();
};
document.getElementById('anterior').onclick = () => {
  if (paginaAtual > 1) {
    paginaAtual--;
    buscaInput.value = '';
    carregarJogos();
  }
};

// Sincroniza a barra de pesquisa do header com a busca da lista
const headerBuscaInput = document.getElementById('header-busca');
const headerBuscarBtn = document.getElementById('header-buscar');

if (headerBuscaInput && buscaInput) {
  // Ao digitar no header, filtra a lista
  headerBuscaInput.addEventListener('input', () => {
    buscaInput.value = headerBuscaInput.value;
    filtrarJogos();
  });
  // Ao clicar no botão do header, filtra a lista
  if (headerBuscarBtn) {
    headerBuscarBtn.addEventListener('click', () => {
      buscaInput.value = headerBuscaInput.value;
      filtrarJogos();
    });
  }
  // Sincroniza busca da lista com o header
  buscaInput.addEventListener('input', () => {
    headerBuscaInput.value = buscaInput.value;
  });
}

carregarJogos();

</script>

</body>
</html>
